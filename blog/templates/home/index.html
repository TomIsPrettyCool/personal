{% extends 'base.html' %} {% block content %}
<div class="container">
  <div class="divider"></div>
</div>
<div class="section blue">
  <div class="container">
    <div class="row">
      <div class="col s12 m12 l6">
        <h3 class="white-text" style="font-weight:300">Me.</h3>
        <p>16. Good at python, make webapps in Flask.</p>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean sagittis magna ultricies sodales commodo. Aenean
          imperdiet ac risus nec tincidunt. Etiam tempus a enim at accumsan. Quisque eget ligula eget augue iaculis convallis
          ac a lectus. Duis malesuada quam non tortor accumsan, quis pretium dui sagittis. Fusce non magna id ipsum rutrum
          volutpat. Duis vitae condimentum quam. Cras pellentesque nulla massa, in auctor lectus molestie egestas.</p>
      </div>
      <div class="col s12 m12 l6">
        <div class="card">
          <div class="card-content">
            <div class="card-title">My GitHub</div>
            <div class="collection">
              <!-- Github repo list -->
            </div>
            <p class="github-activity"></p>
            <div class="center preloader-jquery-hook">
              <div class="preloader-wrapper big active">
                <div class="spinner-layer spinner-blue-only">
                  <div class="circle-clipper left">
                    <div class="circle"></div>
                  </div>
                  <div class="gap-patch">
                    <div class="circle"></div>
                  </div>
                  <div class="circle-clipper right">
                    <div class="circle"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="section">
  <div class="container">
    {% if post %}
    <div class="row">
      <div class="col s12 l6">
        <div class="card">
        <div class="card-content">
        <span class="card-title">My Blog</span>  
        <h4 style="font-weight:300;font-style:italic;"><a href="{{ url_for('blog.view_post', id=post.id) }}">#{{ post.id }}: {{ post.title }}</a></h4>
        <div class="">
          {{ post.content[:1000]| safe }}...<a href="{{ url_for('blog.view_post', id=post.id) }}">(Read More)</a>
        </div>
        </div>
        </div>
      </div>
      <div class="col s12 l6">
      {% else %}
      <div class="col l12">
      {% endif %}
      <div class="card">
        <div class="card-content">
          <span class="card-title">Contact Me</span>
          {% if contact.errors %}
            {% for error in contact.errors %}
              <p class="red-text">There was an error with the field: {{ error }}</p>
            {% endfor %}
          {% endif %}
          <form method="POST" action="/">
            {{ contact.hidden_tag() }}
            <div class="input-field">
              <label for="name">Your Name</label>
              {{ contact.name() }}
            </div>
            <div class="input-field">
              <label for="email">Your Email</label>
              {{ contact.email() }}
            </div>
            <div class="input-field">
              <label for="email">Subject</label>
              {{ contact.subject() }}
            </div>
            <div class="input-field">
              <label for="message">Message</label>
              {{ contact.message(class_="materialize-textarea") }}
            </div>
            </div>
            <div class="card-action">
              <button class="black waves-effect waves-light btn" type="submit">send</button>
            </div>
          </form>
        </div>
      </div>
    </div>  
    </div>  
    </div>
    </div>
  </div>
  <script>
var recent_repos = {}
var last_activity = {}
// Get list of github repos
$(function (){
  $.when(
    $.get("/api/v1/github/get_recent_repos/",
    function( data ){ recent_repos = data; },
    "json"),

    $.get("/api/v1/github/last_activity",
    function( data ){ last_activity = data; },
    "json")

  ).then(function() {
      
      for (item in recent_repos ){
        $(".collection").append("<a href=" + recent_repos[item].url + " class='black-text card-item collection-item'>" + recent_repos[item].name + "</a>");
      }

      $(".github-activity").append("I was last " + last_activity.activity + " <a href='" + last_activity.repo.url + 
                                    "'>" + last_activity.commit_message + "</a>. <i>" + last_activity.time + "</i>");

      $(".preloader-jquery-hook").remove();
    }
  )
})




</script> {% endblock %}